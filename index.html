<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skyblock Guide</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="head-content" style="display: flex; justify-content: space-between">
      <h1>SCL</h1>
      <h1>Skyblock Guide</h1>
      <div>
        <h1 id="usernameDisplay"></h1>
        <p id="cuteProfile"></p>
        <p>is linked</p>
      </div>
    </div>

    <!-- Modal Trigger Button -->
    <button id="modalButton">Enter Username</button>

    <!-- Modal Structure -->
    <div id="usernameModal" class="modal" style="display:none;"> <!-- Ensure modal is hidden by default -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Enter Username</h2>
        <input type="text" id="usernameInput" placeholder="Enter username" />
        <button id="fetchButton" onclick="getuuid()">Fetch UUID</button> <!-- Fetch button -->
      </div>
    </div>

    <select id="profileDropdown"></select>

    <nav>
      <a href="farming.html" role="button">farming</a>
      <a href="mining.html" role="button">mining</a>
      <!-- other links -->
    </nav>
    <!-- Modal and script logic -->
    <script>
      // Get modal elements
      var modal = document.getElementById("usernameModal");
      var btn = document.getElementById("modalButton");
      var span = document.getElementsByClassName("close")[0];

      // Open the modal when the "Enter Username" button is clicked
      btn.onclick = function () {
        modal.style.display = "block";
      };

      // Close the modal when the user clicks on the 'x'
      span.onclick = function () {
        modal.style.display = "none";
      };

      // Close the modal if the user clicks outside of the modal content
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      // Function to fetch UUID and Skyblock data
      function getuuid() {
        const username = document.getElementById("usernameInput").value;

        if (!username) {
          alert("Please enter a username.");
          return; // Stop the function if the input is empty
        }

        // Fetch new data from the backend (make sure your dataManager is working)
        dataManager.fetchUUIDAndData(username).then((data) => {
          if (data) {
            // Close the modal after a successful fetch
            modal.style.display = "none";

            // Populate the profile dropdown
            generateProfileDropdown();

            // Update the page with data from the selected profile
            updatePageData();
          }
        });
      }

      // Ensure the modal does not open automatically
      document.addEventListener("DOMContentLoaded", function () {
        generateProfileDropdown();
        updatePageData(); // These should run without opening the modal
      });
    </script>

    <script src="dataManager.js"></script>
    <script src="main.js"></script>
  </body>
</html>
